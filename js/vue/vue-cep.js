Vue.component('vue-cep',{template:'<div id="vue-cep"> <div id="modalCEP" class="modal" tabindex="-1" role="dialog"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title">Pesquisar CEP</h5> <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> </div><div class="modal-body"> <form v-on:submit.prevent="buscaCep"> <div class="form-group row"> <div class="col-4 col-sm-4 col-md-3"> <select class="form-control" id="selectUF" name="selectUF" v-model="buscarCep.uf" v-on:change="getCidade" required> <option value="" selected disabled>UF</option> <option v-for="uf in buscarCep.options.uf" v-bind:value="uf">{{uf}}</option> </select> </div><div class="col-8 col-sm-8 col-md-9"> <select class="form-control" id="selectCidade" name="selectCidade" v-model="buscarCep.cidade" required> <option value="" disabled selected>Cidade</option> <option v-for="cidade in buscarCep.options.cidades" v-bind:value="cidade">{{cidade}}</option> </select> </div></div><div class="form-group row"> <div class="col-12 col-sm-12 col-md-12"> <div class="input-group"> <input type="text" class="form-control" id="inputEndereco" name="inputEndereco" v-model="buscarCep.logradouro" placeholder="Endereço" required> <span class="input-group-btn"> <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button> </span> </div></div></div></form> </div></div></div></div><div class="form-group row"> <div class="col-12 col-sm-12 col-md-2"> <input class="form-control" id="cep" name="cep" type="text" pattern="\d{5}-\d{3}" placeholder="CEP" v-model="cep" v-on:input="buscar" > <small class="form-text text-muted"> <a href="#" data-toggle="modal" data-target="#modalCEP" v-on:click="getUF">Não sei meu CEP</a> </small> </div></div><div class="row"> <div class="form-group col-12 col-sm-12 col-md-6"> <input class="form-control" type="text" placeholder="Endereço" v-model="endereco.logradouro" readonly> </div><div class="form-group col-12 col-sm-12 col-md-2"> <input class="form-control" type="text" placeholder="Número" ref="numero"> </div><div class="form-group col-12 col-sm-12 col-md-4"> <input class="form-control" type="text" placeholder="Complemento"> </div></div><div class="row"> <div class="form-group col-12 col-sm-12 col-md-5"> <input class="form-control" type="text" placeholder="Bairro" v-model="endereco.bairro" readonly> </div><div class="form-group col-12 col-sm-12 col-md-5"> <input class="form-control" type="text" placeholder="Cidade" v-model="endereco.localidade" readonly> </div><div class="form-group col-12 col-sm-12 col-md-2"> <input class="form-control" type="text" placeholder="UF" v-model="endereco.uf" readonly> </div></div></div>',data:function(){return{cep:'',endereco:{},buscarCep:{uf:'',cidade:'',logradouro:'',json:[],options:{uf:[],cidades:[],}},}},mounted:function(){this.$nextTick(function(){let self=this;$.getJSON("https://gist.githubusercontent.com/letanure/3012978/raw/36fc21d9e2fc45c078e0e0e07cce3c81965db8f9/estados-cidades.json",function(json){self.buscarCep.json=json.estados})})},methods:{getUF:function(){this.buscarCep.options.uf=[];let self=this;$.each(this.buscarCep.json,function(key,val){self.buscarCep.options.uf.push(val.sigla)})},getCidade:function(){this.buscarCep.cidade='';let self=this;this.buscarCep.options.cidades=$.grep(this.buscarCep.json,function(e){return e.sigla===self.buscarCep.uf})[0].cidades},buscaCep:function(){let self=this;$.getJSON("https://viacep.com.br/ws/"+this.buscarCep.uf+"/"+this.buscarCep.cidade+"/"+this.buscarCep.logradouro+"/json/",function(json){$('#modalCEP').modal('toggle');self.cep=json[0].cep;self.endereco=json[0];$(self.$refs.numero).focus()})},buscar:function(){let self=this;self.endereco={};if(/^[0-9]{5}-[0-9]{3}$/.test(this.cep)){$.getJSON("https://viacep.com.br/ws/"+this.cep+"/json/",function(endereco){if(endereco.erro){self.endereco={};return}
self.endereco=endereco;$(self.$refs.numero).focus()})}}}})